\documentclass[11pt,a4paper]{article}

% Basic packages
\usepackage[top=2.5cm,bottom=2.5cm,left=2.5cm,right=2.5cm]{geometry}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{titlesec}
\usepackage{enumitem}
\usepackage{bookmark}
\usepackage{fancyvrb}
\usepackage{newunicodechar}
\usepackage{csquotes}
\usepackage{microtype}
\usepackage{float}
\usepackage[english]{babel}
\usepackage{amsmath}
\usepackage{amssymb}

% Colors
\definecolor{codebackground}{rgb}{0.95,0.95,0.95}
\definecolor{codeborder}{rgb}{0.8,0.8,0.8}
\definecolor{linkcolor}{RGB}{65,105,225}
\definecolor{citecolor}{RGB}{0,128,0}

% Page style
\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\rightmark}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}

% Code blocks
\lstset{
  backgroundcolor=\color{codebackground},
  frame=single,
  rulecolor=\color{codeborder},
  basicstyle=\ttfamily\small,
  breaklines=true,
  breakatwhitespace=true,
  showstringspaces=false,
  numbers=left,
  numberstyle=\tiny\color{gray},
  keywordstyle=\color{blue},
  commentstyle=\color{green!60!black},
  stringstyle=\color{red},
  postbreak={\mbox{\textcolor{red}{\textgreater}\space}}
}

% Section styling
\titleformat{\section}
  {\Large\bfseries}
  {\thesection}
  {1em}
  {}
  [\titlerule]
\titleformat{\subsection}
  {\large\bfseries}
  {\thesubsection}
  {1em}
  {}
\titleformat{\subsubsection}
  {\bfseries}
  {\thesubsubsection}
  {1em}
  {}

% Hyperref setup
\hypersetup{
  colorlinks=true,
  linkcolor=linkcolor,
  filecolor=linkcolor,
  urlcolor=linkcolor,
  citecolor=citecolor,
  linktoc=all,
  unicode=true,
  pdfencoding=auto
}

% Figure handling
\let\origfigure\figure
\let\endorigfigure\endfigure
\renewenvironment{figure}[1][2] {
  \expandafter\origfigure\expandafter[H]
} {
  \endorigfigure
}

% Fix for underscore and other special characters
\catcode`\_=12
\DeclareRobustCommand{\underscore}{\textunderscore}

% Define tightlist command
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

% Begin document
\begin{document}
$if(title)$
\title{$title$}
\author{$author$}
\date{$date$}
\maketitle
$endif$
$body$
\end{document} 